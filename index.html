<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Verse - Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</title>
<style>
/* Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(to bottom right,#581c87,#1e3a8a,#000);min-height:100vh;color:white}
header{background:rgba(0,0,0,0.5);backdrop-filter:blur(20px);border-bottom:1px solid rgba(168,85,247,0.3);position:sticky;top:0;z-index:1000}
.header-container{max-width:1200px;margin:0 auto;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
.logo-container{position:relative}
.logo-glow{position:absolute;inset:0;background:#a855f7;filter:blur(40px);opacity:0.5;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:0.5}50%{opacity:0.8}}
h1{font-size:2rem;font-weight:bold;background:linear-gradient(to right,#c084fc,#f472b6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;position:relative}
.header-actions{display:flex;gap:1rem;align-items:center}
button{padding:0.5rem 1.5rem;border:none;border-radius:0.5rem;cursor:pointer;font-weight:bold;transition:all 0.3s;display:flex;align-items:center;gap:0.5rem;font-size:1rem}
.btn-login{background:linear-gradient(to right,#a855f7,#ec4899)}
.btn-login:hover{background:linear-gradient(to right,#9333ea,#db2777)}
.btn-register{background:linear-gradient(to right,#3b82f6,#06b6d4)}
.btn-register:hover{background:linear-gradient(to right,#2563eb,#0891b2)}
.btn-logout{background:#ef4444}
.btn-logout:hover{background:#dc2626}
.btn-add{background:linear-gradient(to right,#22c55e,#10b981)}
.btn-add:hover{background:linear-gradient(to right,#16a34a,#059669)}
.user-info{color:#d8b4fe;display:flex;align-items:center;gap:0.5rem}
.owner-badge{background:#eab308;color:black;padding:0.25rem 0.5rem;border-radius:0.25rem;font-size:0.75rem}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);z-index:2000;align-items:center;justify-content:center;padding:1rem}
.modal.active{display:flex}
.modal-content{background:linear-gradient(to bottom right,#581c87,#1e3a8a);padding:2rem;border-radius:1rem;max-width:500px;width:100%;border:2px solid rgba(168,85,247,0.5);box-shadow:0 20px 50px rgba(0,0,0,0.5)}
.modal-content h2{text-align:center;margin-bottom:1.5rem;font-size:1.5rem}
.error-message{background:rgba(239,68,68,0.2);border:1px solid #ef4444;color:#fca5a5;padding:0.75rem 1rem;border-radius:0.5rem;margin-bottom:1rem}
input[type="text"],input[type="password"]{width:100%;background:rgba(0,0,0,0.5);border:1px solid rgba(168,85,247,0.3);border-radius:0.5rem;padding:0.75rem 1rem;color:white;margin-bottom:1rem;font-size:1rem}
input:focus{outline:none;border-color:#a855f7}
.modal-buttons{display:flex;gap:0.75rem}
.modal-buttons button{flex:1;justify-content:center}
.btn-cancel{background:#4b5563}
.btn-cancel:hover{background:#374151}
main{max-width:1200px;margin:0 auto;padding:3rem 2rem}
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:2rem}
.game-card{background:rgba(0,0,0,0.4);backdrop-filter:blur(20px);border-radius:1rem;overflow:hidden;border:1px solid rgba(168,85,247,0.3);transition:all 0.3s}
.game-card:hover{transform:scale(1.05);border-color:#a855f7;box-shadow:0 20px 50px rgba(168,85,247,0.5)}
.game-image-container{position:relative;overflow:hidden;height:320px}
.game-image-container img{width:100%;height:100%;object-fit:cover;transition:transform 0.5s}
.game-card:hover .game-image-container img{transform:scale(1.1)}
.image-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.8),transparent)}
.btn-edit{position:absolute;top:1rem;left:1rem;background:#3b82f6;padding:0.5rem;border-radius:0.5rem}
.btn-edit:hover{background:#2563eb}
.game-content{padding:1.5rem}
.game-title{font-size:1.5rem;font-weight:bold;margin-bottom:1rem;text-align:right}
.game-stats{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
.stat{display:flex;align-items:center;gap:0.5rem}
.stat.downloads{color:#4ade80}
.stat.rating{color:#facc15}
.rating-stars{display:flex;gap:0.5rem;justify-content:center;margin-bottom:1rem}
.star{cursor:pointer;transition:transform 0.2s;font-size:1.5rem}
.star:hover{transform:scale(1.25)}
.star.filled{color:#facc15}
.star.empty{color:#6b7280}
.btn-download{width:100%;background:linear-gradient(to right,#22c55e,#10b981);justify-content:center;padding:0.75rem;margin-bottom:1rem}
.btn-download:hover{background:linear-gradient(to right,#16a34a,#059669)}
.comments-section{border-top:1px solid rgba(168,85,247,0.3);padding-top:1rem}
.comments-header{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem;color:#c084fc}
.comments-list{max-height:240px;overflow-y:auto;margin-bottom:0.75rem}
.comment{background:rgba(88,28,135,0.3);padding:0.75rem;border-radius:0.5rem;margin-bottom:0.75rem;text-align:right}
.comment-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
.comment-user{color:#d8b4fe;font-weight:bold}
.comment-date{font-size:0.75rem;color:#9ca3af}
.comment-text{font-size:0.875rem}
.comment-edited{font-size:0.7rem;color:#9ca3af;font-style:italic;margin-top:0.25rem}
.comment-actions{display:flex;gap:0.5rem;margin-top:0.5rem}
.btn-edit-comment,.btn-delete-comment{padding:0.25rem 0.5rem;font-size:0.75rem;background:#4b5563}
.btn-edit-comment:hover{background:#374151}
.btn-delete-comment{background:#ef4444}
.btn-delete-comment:hover{background:#dc2626}
.comment-input-container{display:flex;gap:0.5rem}
.comment-input-container input{flex:1;margin-bottom:0}
.btn-send{background:#a855f7;padding:0.5rem 1rem}
.btn-send:hover{background:#9333ea}
@media(max-width:768px){.games-grid{grid-template-columns:1fr}.header-container{flex-direction:column;gap:1rem}}
</style>
</head>
<body>
<header>
<div class="header-container">
<div class="logo-container">
<div class="logo-glow"></div>
<h1>Game Verse</h1>
</div>
<div class="header-actions" id="headerActions"></div>
</div>
</header>

<!-- Modals for login/register/add/edit remain unchanged (Ù…Ø«Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚) -->

<main>
<div class="games-grid" id="gamesGrid"></div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
import { getFirestore, collection, addDoc, doc, getDocs, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBZrXdUHJbLfgcZ1E-yH41DrqbYgN0rXe0",
  authDomain: "gameverse5.firebaseapp.com",
  projectId: "gameverse5",
  storageBucket: "gameverse5.firebasestorage.app",
  messagingSenderId: "334892403820",
  appId: "1:334892403820:web:ae46ebc2d6f5eb1be89c49",
  measurementId: "G-JMJLD5KCS7"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);

// ---- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ----
let users = [{username:"lttl.5",password:"admin",isOwner:true}];
let currentUser = null;

// ---- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ----
function updateHeader() {
  const headerActions = document.getElementById('headerActions');
  if(currentUser){
    headerActions.innerHTML = `
      <span class="user-info">ğŸ‘¤ ${currentUser.username} ${currentUser.isOwner?'<span class="owner-badge">Ù…Ø§Ù„Ùƒ</span>':''}</span>
      ${currentUser.isOwner?'<button class="btn-add" onclick="openAddModal()">â• Ø¥Ø¶Ø§ÙØ© Ù„Ø¹Ø¨Ø©</button>':''}
      <button class="btn-logout" onclick="handleLogout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    `;
  } else {
    headerActions.innerHTML = `
      <button class="btn-login" onclick="openLoginModal()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
      <button class="btn-register" onclick="openRegisterModal()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    `;
  }
}

// ---- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ù…Ù† Firestore Ù…Ø¨Ø§Ø´Ø±Ø© ----
const gamesCol = collection(db,'games');
onSnapshot(gamesCol, snapshot=>{
  const gamesData = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
  renderGames(gamesData);
});

// ---- Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ----
function renderGames(games){
  const grid = document.getElementById('gamesGrid');
  grid.innerHTML = games.map(game=>{
    const avgRating = game.ratings? (game.ratings.reduce((a,b)=>a+b.rating,0)/game.ratings.length).toFixed(1) : 0;
    const userRating = currentUser && game.ratings? (game.ratings.find(r=>r.user===currentUser.username)?.rating || 0) : 0;
    const commentsHtml = (game.comments||[]).map(c=>{
      const canEdit = currentUser && (c.user===currentUser.username || currentUser.username==="lttl.5");
      return `<div class="comment">
        <div class="comment-header"><span class="comment-user">${c.user}</span> <span class="comment-date">${c.date}</span></div>
        <p class="comment-text">${escapeHtml(c.text)}</p>
        ${c.edited?'<p class="comment-edited">ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡</p>':''}
        ${canEdit?`<div class="comment-actions">
          <button class="btn-edit-comment" onclick="editComment('${game.id}','${c.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn-delete-comment" onclick="deleteComment('${game.id}','${c.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>`:''}
      </div>`;
    }).join('');
    return `<div class="game-card">
      <div class="game-image-container"><img src="${game.image}" alt="${escapeHtml(game.name)}"><div class="image-overlay"></div>
      ${currentUser&&currentUser.isOwner?`<button class="btn-edit" onclick="openEditModal('${game.id}')">âœï¸</button>`:''}</div>
      <div class="game-content">
        <h3 class="game-title">${escapeHtml(game.name)}</h3>
        <div class="game-stats">
          <div class="stat downloads">ğŸ“¥ ${game.downloads||0} ØªØ­Ù…ÙŠÙ„</div>
          <div class="stat rating">â­ ${avgRating} (${(game.ratings||[]).length})</div>
        </div>
        <div class="rating-stars">${[1,2,3,4,5].map(s=>`<span class="star ${s<=userRating?'filled':'empty'}" onclick="rateGame('${game.id}',${s})">â˜…</span>`).join('')}</div>
        <a href="${game.downloadUrl}" target="_blank" onclick="downloadGame('${game.id}')" class="btn-download">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</a>
        <div class="comments-section">
          <div class="comments-header">ğŸ’¬ ${(game.comments||[]).length} ØªØ¹Ù„ÙŠÙ‚</div>
          <div class="comments-list">${commentsHtml}</div>
          <div class="comment-input-container">
            <input type="text" id="comment-${game.id}" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ..." onkeypress="if(event.key==='Enter') sendComment('${game.id}')">
            <button class="btn-send" onclick="sendComment('${game.id}')">Ø¥Ø±Ø³Ø§Ù„</button>
          </div>
        </div>
      </div>
    </div>`;
  }).join('');
}

// ---- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ----
function escapeHtml(t){return t?String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'):"";}

</script>
</body>
</html>
